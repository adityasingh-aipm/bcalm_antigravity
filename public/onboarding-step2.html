<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Target Role - Bcalm CV Score</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/onboarding.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="step-indicator">Step 2 of 3 · ~20 sec</div>
      
      <h1 class="title">What role are you aiming for?</h1>
      <p class="subtitle">We'll tailor the CV review to this role.</p>
      
      <div class="section-label">Popular picks</div>
      <div class="chips-container" id="roleChips"></div>
      
      <input 
        type="text" 
        class="search-input" 
        id="roleInput" 
        placeholder="Type a role (e.g., Product Manager, Data Analyst…)"
      >
      
      <button class="safe-option" id="notSureBtn">Not sure yet — score me for general readiness</button>
      
      <div class="buttons">
        <div class="buttons-row">
          <button class="btn btn-secondary" id="backBtn">Back</button>
          <button class="btn btn-primary" id="continueBtn" disabled>Continue</button>
        </div>
        <button class="skip-link" id="skipBtn">Skip for now</button>
      </div>
    </div>
  </div>
  
  <script src="/onboarding.js"></script>
  <script>
    let selectedRole = null;
    let isNotSure = false;
    
    const rolesByStatus = {
      'Student / Fresher': [
        'Product Analyst',
        'Associate PM',
        'Business Analyst',
        'Data Analyst',
        'Management Trainee',
        'Consultant'
      ],
      'Working Professional': [
        'Product Manager',
        'Senior PM',
        'Data Scientist',
        'Engineering Manager',
        'Strategy Lead',
        'Program Manager'
      ],
      'Switching Careers': [
        'Product Manager',
        'Business Analyst',
        'Data Analyst',
        'UX Designer',
        'Growth Manager',
        'Operations Manager'
      ],
      'default': [
        'Product Manager',
        'Business Analyst',
        'Data Analyst',
        'Consultant',
        'Growth Manager',
        'Associate PM'
      ]
    };
    
    async function initPage() {
      const profile = await getProfile();
      const status = profile?.current_status || 'default';
      const roles = rolesByStatus[status] || rolesByStatus['default'];
      
      const chipsContainer = document.getElementById('roleChips');
      chipsContainer.innerHTML = roles.map(role => 
        `<div class="chip" data-value="${role}">${role}</div>`
      ).join('');
      
      document.querySelectorAll('.chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
          chip.classList.add('selected');
          selectedRole = chip.dataset.value;
          isNotSure = false;
          document.getElementById('notSureBtn').classList.remove('selected');
          document.getElementById('roleInput').value = '';
          document.getElementById('continueBtn').disabled = false;
        });
      });
    }
    
    document.getElementById('roleInput').addEventListener('input', (e) => {
      const value = e.target.value.trim();
      if (value) {
        selectedRole = value;
        isNotSure = false;
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        document.getElementById('notSureBtn').classList.remove('selected');
        document.getElementById('continueBtn').disabled = false;
      } else {
        if (!document.querySelector('.chip.selected') && !isNotSure) {
          document.getElementById('continueBtn').disabled = true;
        }
      }
    });
    
    document.getElementById('notSureBtn').addEventListener('click', () => {
      isNotSure = true;
      selectedRole = null;
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
      document.getElementById('roleInput').value = '';
      document.getElementById('notSureBtn').classList.add('selected');
      document.getElementById('continueBtn').disabled = false;
    });
    
    document.getElementById('backBtn').addEventListener('click', () => {
      window.location.href = '/onboarding';
    });
    
    document.getElementById('continueBtn').addEventListener('click', async () => {
      const inputValue = document.getElementById('roleInput').value.trim();
      const roleToSave = inputValue || selectedRole;
      await saveRole(roleToSave);
      window.location.href = '/onboarding/experience';
    });
    
    document.getElementById('skipBtn').addEventListener('click', async () => {
      await saveRole(null);
      window.location.href = '/onboarding/experience';
    });
    
    initPage();
  </script>
</body>
</html>
